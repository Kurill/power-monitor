<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ú–æ—ó –ø—Ä–∏—Å—Ç—Ä–æ—ó ‚Äî Power Monitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;800&family=Onest:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/dashboard.css?v=4">
</head>
<body>
    <div class="grid-bg"></div>

    <div class="container">
        <div class="header">
            <a href="/" class="logo">
                <div class="logo-icon">‚ö°</div>
                <span class="logo-text">Power Monitor</span>
            </a>
            <div class="user-section">
                <span class="user-email" id="userEmail"></span>
                <button class="btn-small" onclick="logout()">–í–∏–π—Ç–∏</button>
            </div>
        </div>

        <div class="actions">
            <a href="/flash" class="btn btn-primary">‚ö° –ü—Ä–æ—à–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π</a>
            <button class="btn btn-secondary" onclick="openSubscribeModal()">üîó –ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
        </div>

        <div id="content">
            <div class="loading">
                <div class="spinner"></div>
                –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...
            </div>
        </div>

        <div class="footer">
            <a href="/" class="footer-link">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a href="https://t.me/power18b89" class="footer-link" target="_blank">Telegram</a>
        </div>
    </div>

    <!-- Subscribe modal -->
    <div class="modal-overlay" id="subscribeModal">
        <div class="modal">
            <div class="modal-title">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å –Ω–∞ –ø—Ä–∏—Å—Ç—Ä—ñ–π</div>
            <div class="modal-desc">–í–≤–µ–¥—ñ—Ç—å ID –ø—Ä–∏—Å—Ç—Ä–æ—é —â–æ–± –±–∞—á–∏—Ç–∏ –π–æ–≥–æ —Å—Ç–∞—Ç—É—Å</div>
            <div class="form-group">
                <input type="text" class="form-input" id="subscribeId" placeholder="device_id">
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeSubscribeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button class="btn btn-primary" onclick="subscribe()">–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—å</button>
            </div>
        </div>
    </div>

    <!-- Telegram Setup Wizard -->
    <div class="telegram-dialog" id="telegramDialog">
        <div class="telegram-dialog-content">
            <h3>Telegram —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è</h3>

            <!-- Step indicator -->
            <div class="tg-steps">
                <div class="tg-step active" id="tgStep1Ind">
                    <div class="tg-step-num">1</div>
                    <div class="tg-step-label">–¢–æ–∫–µ–Ω</div>
                </div>
                <div class="tg-step-line"></div>
                <div class="tg-step" id="tgStep2Ind">
                    <div class="tg-step-num">2</div>
                    <div class="tg-step-label">–ß–∞—Ç</div>
                </div>
                <div class="tg-step-line"></div>
                <div class="tg-step" id="tgStep3Ind">
                    <div class="tg-step-num">3</div>
                    <div class="tg-step-label">–ì–æ—Ç–æ–≤–æ</div>
                </div>
            </div>

            <!-- Step 1: Bot Token -->
            <div id="tgStep1" class="tg-panel">
                <div class="tg-instruction">
                    <div class="tg-instruction-num">1</div>
                    <div class="tg-instruction-text">
                        –í—ñ–¥–∫—Ä–∏–π <a href="https://t.me/BotFather" target="_blank" class="tg-link">@BotFather</a> –≤ Telegram
                    </div>
                </div>
                <div class="tg-instruction">
                    <div class="tg-instruction-num">2</div>
                    <div class="tg-instruction-text">
                        –í—ñ–¥–ø—Ä–∞–≤ –∫–æ–º–∞–Ω–¥—É <code>/newbot</code> —Ç–∞ —Å–ª—ñ–¥—É–π —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º
                    </div>
                </div>
                <div class="tg-instruction">
                    <div class="tg-instruction-num">3</div>
                    <div class="tg-instruction-text">
                        –°–∫–æ–ø—ñ—é–π —Ç–æ–∫–µ–Ω —Ç–∞ –≤—Å—Ç–∞–≤ —Å—é–¥–∏:
                    </div>
                </div>
                <input type="text" id="tgBotToken" placeholder="123456789:ABCdef..." class="tg-input">
                <button id="tgVerifyToken" class="tg-btn tg-btn-primary">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç–æ–∫–µ–Ω</button>
                <div id="tgTokenStatus" class="tg-status"></div>
            </div>

            <!-- Step 2: Find Chats -->
            <div id="tgStep2" class="tg-panel" style="display:none;">
                <div class="tg-bot-info" id="tgBotInfo">
                    <div class="tg-bot-avatar">ü§ñ</div>
                    <div class="tg-bot-details">
                        <div class="tg-bot-name" id="tgBotName">Bot Name</div>
                        <div class="tg-bot-username" id="tgBotUsername">@username</div>
                    </div>
                    <div class="tg-bot-check">‚úì</div>
                </div>

                <div class="tg-instruction">
                    <div class="tg-instruction-num">1</div>
                    <div class="tg-instruction-text">
                        –î–æ–¥–∞–π –±–æ—Ç–∞ –≤ <strong>–∫–∞–Ω–∞–ª</strong> –∞–±–æ <strong>–≥—Ä—É–ø—É</strong>
                    </div>
                </div>
                <div class="tg-instruction">
                    <div class="tg-instruction-num">2</div>
                    <div class="tg-instruction-text">
                        –ù–∞–ø–∏—à–∏ –±—É–¥—å-—è–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —Ü–µ–π —á–∞—Ç
                    </div>
                </div>
                <div class="tg-hint">
                    <span class="tg-hint-icon">üí°</span>
                    <span class="tg-hint-text">–©–æ–± –∞–≤–∞—Ç–∞—Ä–∫–∞ –∫–∞–Ω–∞–ª—É –∑–º—ñ–Ω—é–≤–∞–ª–∞—Å—å (üü¢/üî¥), –±–æ—Ç –º–∞—î –±—É—Ç–∏ <strong>–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</strong>. –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ª–∏—à–µ —Ç–µ–∫—Å—Ç–æ–≤—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è ‚Äî –∞–¥–º—ñ–Ω –ø—Ä–∞–≤–∞ –Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ.</span>
                </div>

                <button id="tgFindChats" class="tg-btn tg-btn-primary">
                    <span>üîç</span> –ó–Ω–∞–π—Ç–∏ —á–∞—Ç–∏
                </button>

                <div id="tgChatList" class="tg-chat-list" style="display:none;"></div>
                <div id="tgStep2Status" class="tg-status"></div>
            </div>

            <!-- Step 3: Done -->
            <div id="tgStep3" class="tg-panel" style="display:none;">
                <div class="tg-success-icon">üéâ</div>
                <div class="tg-success-title">Telegram –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ!</div>
                <div class="tg-success-desc">
                    –¢–µ–ø–µ—Ä –≤–∏ –±—É–¥–µ—Ç–µ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —Å–≤—ñ—Ç–ª–æ
                </div>
                <div class="tg-selected-chat">
                    <div class="tg-chat-icon">üí¨</div>
                    <div class="tg-chat-info">
                        <div class="tg-chat-name" id="tgSelectedChatName">Chat Name</div>
                        <div class="tg-chat-type" id="tgSelectedChatId">ID: -100...</div>
                    </div>
                </div>
                <button id="tgSendTest" class="tg-btn tg-btn-primary">
                    <span>üì§</span> –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                </button>
            </div>

            <button class="tg-close" onclick="closeTelegramDialog()">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <!-- WiFi Setup Dialog -->
    <div class="wifi-dialog" id="wifiDialog">
        <div class="wifi-dialog-content">
            <h3>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è WiFi</h3>
            <p class="wifi-hint">–ü—ñ–¥–∫–ª—é—á–∏ ESP32 –¥–æ USB —Ç–∞ –Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ</p>

            <button id="wifiConnectBtn" class="wifi-btn wifi-btn-connect">
                <span>üîå</span> –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å –¥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é
            </button>

            <div id="wifiMain" style="display:none;">
                <div id="wifiNetworkList" class="wifi-network-list">
                    <div class="wifi-network-empty">–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è...</div>
                </div>

                <input type="text" id="wifiSsid" placeholder="–ê–±–æ –≤–≤–µ–¥–∏ SSID –≤—Ä—É—á–Ω—É" class="wifi-input">
                <input type="password" id="wifiPass" placeholder="–ü–∞—Ä–æ–ª—å" class="wifi-input">

                <div class="wifi-buttons">
                    <button id="wifiSaveBtn" class="wifi-btn wifi-btn-save">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                    <button id="wifiTestBtn" class="wifi-btn wifi-btn-test">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
                </div>

                <div id="wifiLog" class="wifi-log"></div>
            </div>

            <div id="wifiSuccess" class="wifi-success" style="display:none;">
                <div class="wifi-success-icon">‚úì</div>
                <div class="wifi-success-text">WiFi –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ!</div>
            </div>

            <button class="wifi-close" onclick="closeWifiDialog()">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <script src="/improv.js?v=2"></script>
    <script src="/dashboard.js?v=6"></script>
</body>
</html>
